# imageviewer
![](../gif/7.图片缩放效果实现.gif)
## ImageViewerView
### 属性和状态
- **isEnableSwipe**: 声明并初始化一个状态变量，控制是否启用滑动功能。
- **bgc**: 声明并提供一个颜色状态，初始值为白色。
- **imageDataSource**: 声明并初始化一个懒加载数据源，用于存储图片数据。
- **context: 获取当前上下文。
- **swipeController: 声明并初始化一个滑动控制器。
<br/>

__CommonLazyDataSourceModel__ 是一个用于管理数据的通用懒加载数据源模型。在UI开发中，懒加载是一种常见的优化技术，可以在需要时才加载和显示数据，从而提高性能和用户体验。
1. pushData： 添加数据到数据源的末尾。
2. getData： 根据索引获取数据项。
3. notifyDataReload： 通知所有监听器数据需要重新加载。
4. notifyDataAdd： 通知所有监听器在指定索引处添加数据。
5. notifyDataChange：通知所有监听器指定索引处的数据发生变化。
6. notifyDataDelete：通知所有监听器删除指定索引处的数据。
7. registerDataChangeListener：注册一个数据变化监听器。
8. unregisterDataChangeListener：注销一个数据变化监听器。
<br/>

__getContext__ 是一个常用的方法，用于获取当前组件或应用的上下文信息。上下文（context）通常包含应用程序的全局状态、配置信息或环境信息，使得组件能够在其内部或在其子组件中访问这些共享的信息。以下是一些常见成员和方法：
1. resourceDir: 资源目录路径。
2. cacheDir: 缓存目录路径。
3. filesDir: 应用私有文件目录路径。
4. appInfo: 应用程序信息对象，包含应用的基本信息。
5. display: 当前显示信息对象，包含屏幕尺寸、分辨率等信息。
<br/>

__SwiperController__ 提供了一种方式，通过编程接口来控制 Swiper 组件的各种行为。例如，可以通过 SwiperController 来启动或停止自动播放、手动滑动到特定的页面、启用或禁用滑动等。SwiperController 的常用方法:
* swipeTo(index: number): 手动滑动到指定索引的页面。
* next(): 滑动到下一个页面。
* previous(): 滑动到上一个页面。
* startAutoPlay(): 开始自动播放。
* stopAutoPlay(): 停止自动播放。
<br/>

### build
- **Swiper**: 使用Swiper组件，传入滑动控制器。
    - **LazyForEach**: 使用LazyForEach懒加载组件，遍历图片数据源。
    - **ImageItemView**: 使用ImageItemView组件，显示图片。
        - **width**: 设置图片项宽度。
        - **height**: 设置图片项高度。
- **onClick**: 设置点击事件，切换背景色。
- **this.bgc**: 切换背景颜色。
- **width**: 设置Swiper组件的宽度。
- **height**: 设置Swiper组件的高度。
- **expandSafeArea**: 扩展安全区域。
- **autoPlay**: 禁用自动播放。
- **disableSwipe**: 根据状态变量控制是否禁用滑动。
- **loop**: 禁用循环播放。
- **indicator**: 禁用指示器。
- **cachedCount**: 设置缓存数量。
<br/>

## ImageItemView
### 属性和状态
- **@Consume private bgc: Color;**: 通过依赖注入获取 `bgc` 属性，该属性表示背景颜色。
- **@Link isEnableSwipe: boolean;**: 链接到一个布尔值，用于控制是否启用图片滑动切换功能。
- **@State isEnableOffset: boolean = false;**: 表示是否启用图片偏移。
- **@State imageScaleInfo: ScaleModel = new ScaleModel(1.0, 1.0, 1.5, 0.3);**: 存储图片缩放信息，初始化为缩放比例1.0，最大缩放比例1.5，最小缩放比例0.3。
- **@State imageOffsetInfo: OffsetModel = new OffsetModel(0, 0);**: 存储图片偏移信息，初始化为偏移量0。
- **@State matrix: matrix4.Matrix4Transit = matrix4.identity().copy();**: 存储图片变换矩阵，初始化为单位矩阵。
- **@State imagePixelMap: image.PixelMap | null = null;**: 存储当前显示的图片的 PixelMap 对象，用于 `Image` 组件显示。
- **@State fitWH: "width" | "height" | undefined = undefined;**: 表示当前图片是根据宽度适配还是高度适配。
- **@State imageDefaultSize: image.Size = { width: 0, height: 0 };**: 存储图片默认大小，即与屏幕大小最适配的显示大小。
- **imageUri: string = "";**: 存储当前显示的图片的 URI。
- **imageWHRatio: number = 0;**: 存储图片的原始宽高比。
<br/>

__ScaleModel__ 用于表示图片的缩放信息，包括当前缩放比例、最小缩放比例、最大缩放比例、以及缩放速度。<br/>

**参数**:
- **currentScale**: 初始化时设置当前缩放比例。
- **minScale**: 初始化时设置最小缩放比例。
- **maxScale**: 初始化时设置最大缩放比例。
- **scaleSpeed**: 初始化时设置缩放速度。
<br/>

__OffsetModel__ 用于表示图片的偏移信息，包括偏移的 x 和 y 轴位置。<br/>

**参数**:
- **offsetX**: 初始化时设置 x 轴上的偏移量。
- **offsetY**: 初始化时设置 y 轴上的偏移量。

### aboutToAppear
在组件即将显示时调用，用于初始化当前图片的信息。
<br/>

### calcImageDefaultSize 
用于计算图片的默认显示尺寸，使其能够在屏幕上以最佳比例显示。如果图片宽高比大于屏幕宽高比，则图片以屏幕宽度为基准进行显示，计算对应的高度。否则，图片以屏幕高度为基准进行显示，计算对应的宽度。
<br/>

### calcFitScaleRatio
用于计算图片适配屏幕的缩放比例。如果屏幕宽度大于图片宽度，则图片的缩放比例为屏幕宽度与图片宽度的比值,否则，图片的缩放比例为屏幕高度与图片高度的比值。
<br/>

### initCurrentImageInfo
用于初始化当前图片的信息，包括图片的缩放比例、默认尺寸、像素图等，确保图片在屏幕上能够以最佳的方式显示。
<br/>

### resetCurrentImageInfo
用于重置当前图片的信息，包括缩放比例、偏移量和矩阵信息。这通常用于在用户操作后或图片状态需要恢复初始状态时调用。
<br/>

### evaluateBound
长度为4的boolean数组，表示上下左右是否到达边界。
<br/>

### build
**Stack**: 使用Stack组件作为容器。
- **Image**: 使用Image组件显示图片。
    - **this.imagePixelMap**: 设置图片的数据源。
        - **width**: 根据条件设置图片的宽度，通过保持宽高比来调整另一个属性。
        - **height**: 根据条件设置图片的高度，通过保持宽高比来调整另一个属性。
        - **aspectRatio**: 设置图片的宽高比。
        - **objectFit**: 保持宽高比进行缩放，可以超出父组件，以便实现多图切换的增强功能。
        - **autoResize**: 禁用自动调整大小。
        - **transform**: 通过matrix控制图片的缩放。
        - **defaultFocus**: 设置默认焦点。
        - **expandSafeArea**: 扩展安全区域。
        - v**offset**: 通过offset控制图片的偏移。
- **onBlur**: 设置失去焦点时的事件。
    - **this.resetCurrentImageInfo**: 失去焦点时重置当前图片信息。
- **backgroundColor**: 设置背景颜色。
- **alignContent**: 设置内容对齐方式为居中。
- **expandSafeArea**: 扩展安全区域。
- **width**: 设置Stack组件的宽度。
- **height**: 设置Stack组件的高度。
    - **GestureGroup**: 设置手势控制。
        - **GestureMode**.Exclusive: 设置手势模式为独占模式。
        - **TapGesture**: 双击和单击手势。
        - **双击**: 双击切换图片大小。
        - **单击**: 切换背景色。
        - **PinchGesture**: 双指捏合缩放图片。
            - **onActionUpdate**: 更新缩放值，控制图片的缩放比例。
            - **onActionEnd**: 缩放结束时，恢复到合适的缩放值。
        - **PanGesture**: 滑动图片。
            - **onActionUpdate**: 更新图片的偏移量。
            - **onActionEnd**: 偏移结束时，保存当前偏移量。
<br/>

当使用 ImageFit.Cover 时，图像会根据父组件的尺寸进行缩放，同时保持其原始宽高比。这在多图切换功能中尤为重要，因为可以确保图像在切换时的一致性和视觉效果，即使图像的尺寸不同，也能填充整个显示区域。
<br/>

**expandSafeArea**: <br/>
这是一个用于处理安全区域的属性。安全区域（Safe Area）是指在设备屏幕上内容显示的安全区域，通常用于避免与系统UI元素（如状态栏、导航栏）重叠。
* [SafeAreaType.SYSTEM]: 这是安全区域的类型。在这里，指定了 SafeAreaType.SYSTEM，表示系统定义的安全区域。
* [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM]: 这是安全区域的边缘。在这里，指定了 SafeAreaEdge.TOP 和 SafeAreaEdge.BOTTOM，表示扩展安全区域以覆盖顶部和底部的系统UI元素。


































































































































































































































































































